{
    "openapi": "3.0.3",
    "info": {
        "title": "基础结构化数据分析工具箱2",
        "description": "支持对结构话数据进行处理的工具箱，工具包含: \n1. text2sql\n2. text2metric\n3. sql_helper\n4. knowledge_item\n5. get_metadata\n6. json2plot\n7. execute_code\n8. execute_command\n9. read_file\n10. create_file\n11. list_files\n12. get_status\n13. close_sandbox\n14. download_from_efast\n15. knowledge_rerank\n16. kn_search\n17. kn_path_search\n18. cypher_query\n",
        "version": "1.0.11"
    },
    "servers": [
        {
            "url": "http://data-retrieval:9100"
        }
    ],
    "paths": {
        "/tools/text2sql": {
            "post": {
                "summary": "text2sql",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "description": "根据用户输入的文本和数据视图信息来生成 SQL 语句，并查询数据库。注意: input参数只接受问题，不接受SQL。工具具有更优秀的SQL生成能力，你只需要告诉工具需要查询的内容即可。有时用户只需要生成SQL，不需要查询，需要给出解释\n注意：为了节省 token 数，输出的结果可能不完整，这是正常情况。data_desc 对象来记录返回数据条数和实际结果条数",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "data_source": {
                                        "type": "object",
                                        "description": "视图配置信息",
                                        "properties": {
                                            "view_list": {
                                                "type": "array",
                                                "description": "逻辑视图ID列表",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "base_url": {
                                                "type": "string",
                                                "description": "服务器地址"
                                            },
                                            "token": {
                                                "type": "string",
                                                "description": "认证令牌"
                                            },
                                            "user_id": {
                                                "type": "string",
                                                "description": "用户ID"
                                            },
                                            "account_type": {
                                                "type": "string",
                                                "description": "调用者的类型，user 代表普通用户，app 代表应用账号，anonymous 代表匿名用户",
                                                "enum": [
                                                    "user",
                                                    "app",
                                                    "anonymous"
                                                ],
                                                "default": "user"
                                            },
                                            "kn": {
                                                "type": "array",
                                                "description": "知识网络配置参数",
                                                "items": {
                                                    "type": "object",
                                                    "properties": {
                                                        "knowledge_network_id": {
                                                            "type": "string",
                                                            "description": "知识网络ID"
                                                        },
                                                        "object_types": {
                                                            "type": "array",
                                                            "description": "知识网络对象类型",
                                                            "items": {
                                                                "type": "string"
                                                            }
                                                        }
                                                    },
                                                    "required": [
                                                        "knowledge_network_id"
                                                    ]
                                                }
                                            },
                                            "search_scope": {
                                                "type": "array",
                                                "description": "知识网络搜索范围，支持 object_types, relation_types, action_types",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "recall_mode": {
                                                "type": "string",
                                                "description": "召回模式，支持 keyword_vector_retrieval(默认), agent_intent_planning, agent_intent_retrieval",
                                                "enum": [
                                                    "keyword_vector_retrieval",
                                                    "agent_intent_planning",
                                                    "agent_intent_retrieval"
                                                ],
                                                "default": "keyword_vector_retrieval"
                                            }
                                        },
                                        "required": []
                                    },
                                    "llm": {
                                        "type": "object",
                                        "description": "语言模型配置",
                                        "properties": {
                                            "model_name": {
                                                "type": "string",
                                                "description": "模型名称"
                                            },
                                            "openai_api_key": {
                                                "type": "string",
                                                "description": "OpenAI API密钥"
                                            },
                                            "openai_api_base": {
                                                "type": "string",
                                                "description": "OpenAI API基础URL"
                                            },
                                            "max_tokens": {
                                                "type": "integer",
                                                "description": "最大生成令牌数"
                                            },
                                            "temperature": {
                                                "type": "number",
                                                "description": "生成温度参数"
                                            }
                                        },
                                        "required": []
                                    },
                                    "inner_llm": {
                                        "type": "object",
                                        "description": "内部语言模型配置，用于指定内部使用的 LLM 模型参数，如模型ID、名称、温度、最大token数等。支持通过模型工厂配置模型"
                                    },
                                    "config": {
                                        "type": "object",
                                        "description": "工具配置参数",
                                        "properties": {
                                            "background": {
                                                "type": "string",
                                                "description": "背景信息"
                                            },
                                            "retry_times": {
                                                "type": "integer",
                                                "description": "重试次数",
                                                "default": 3
                                            },
                                            "session_type": {
                                                "type": "string",
                                                "description": "会话类型",
                                                "enum": [
                                                    "in_memory",
                                                    "redis"
                                                ],
                                                "default": "redis"
                                            },
                                            "session_id": {
                                                "type": "string",
                                                "description": "会话ID"
                                            },
                                            "only_essential_dim": {
                                                "type": "boolean",
                                                "description": "在生成的结果解释说明中，是否只展示必要的维度",
                                                "default": true
                                            },
                                            "rewrite_query": {
                                                "type": "boolean",
                                                "description": "是否重写用户输入的自然语言查询，即在生成 SQL 时，根据数据源的描述和样本数据，重写用户输入的自然语言查询，以更符合数据源的实际情况",
                                                "default": false
                                            },
                                            "view_num_limit": {
                                                "type": "integer",
                                                "description": "给大模型选择时引用视图数量限制，-1表示不限制，原因是数据源包含大量视图，可能导致大模型上下文token超限，内置的召回算法会自动筛选最相关的视图",
                                                "default": 5
                                            },
                                            "dimension_num_limit": {
                                                "type": "integer",
                                                "description": "给大模型选择时维度数量限制，-1表示不限制, 系统默认为 30",
                                                "default": 30
                                            },
                                            "force_limit": {
                                                "type": "integer",
                                                "description": "生成的 SQL 的 LIMIT 子句限制，-1表示不限制, 系统默认为 200",
                                                "default": 200
                                            },
                                            "return_record_limit": {
                                                "type": "integer",
                                                "description": "SQL 执行后返回数据条数限制，-1表示不限制，原因是SQL执行后返回大量数据，可能导致大模型上下文token超限",
                                                "default": -1
                                            },
                                            "return_data_limit": {
                                                "type": "integer",
                                                "description": "SQL 执行后返回数据总量限制，单位是字节，-1表示不限制，原因是SQL执行后返回大量数据，可能导致大模型上下文token超限",
                                                "default": -1
                                            }
                                        }
                                    },
                                    "infos": {
                                        "type": "object",
                                        "description": "额外的输入信息, 包含额外信息和知识增强信息",
                                        "properties": {
                                            "knowledge_enhanced_information": {
                                                "type": "object",
                                                "description": "知识增强信息"
                                            },
                                            "extra_info": {
                                                "type": "string",
                                                "description": "额外信息(非知识增强)"
                                            }
                                        }
                                    },
                                    "input": {
                                        "type": "string",
                                        "description": "用户输入的自然语言查询"
                                    },
                                    "action": {
                                        "type": "string",
                                        "description": "工具行为类型，其中gen表示只生成SQL，gen_exec表示生成并执行SQL，show_ds表示只展示数据源信息",
                                        "enum": [
                                            "gen",
                                            "gen_exec",
                                            "show_ds"
                                        ],
                                        "default": "gen_exec"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "请求超时时间（秒），超过此时间未完成则返回超时错误，默认120秒",
                                        "default": 120
                                    }
                                },
                                "required": [
                                    "data_source",
                                    "input",
                                    "action"
                                ]
                            },
                            "example": {
                                "data_source": {
                                    "view_list": [
                                        "view_id"
                                    ],
                                    "base_url": "https://xxxxx",
                                    "token": "",
                                    "user_id": "",
                                    "kg": [
                                        {
                                            "kg_id": "129",
                                            "fields": [
                                                "regions",
                                                "comments"
                                            ]
                                        }
                                    ],
                                    "kn_id": "",
                                    "search_scope": [
                                        "object_types",
                                        "relation_types",
                                        "action_types"
                                    ],
                                    "recall_mode": "keyword_vector_retrieval"
                                },
                                "llm": {
                                    "model_name": "Model Name",
                                    "openai_api_key": "******",
                                    "openai_api_base": "http://xxxx",
                                    "max_tokens": 4000,
                                    "temperature": 0.1
                                },
                                "inner_llm": {
                                    "frequency_penalty": 0,
                                    "id": "1935601639213895680",
                                    "max_tokens": 1000,
                                    "name": "doubao-seed-1.6-flash",
                                    "presence_penalty": 0,
                                    "temperature": 1,
                                    "top_k": 1,
                                    "top_p": 1
                                },
                                "config": {
                                    "background": "",
                                    "retry_times": 3,
                                    "session_type": "in_memory",
                                    "session_id": "123",
                                    "force_limit": 100,
                                    "only_essential_dim": true,
                                    "dimension_num_limit": 10,
                                    "return_record_limit": 10,
                                    "return_data_limit": 1000,
                                    "view_num_limit": 5,
                                    "rewrite_query": false,
                                    "show_sql_graph": false,
                                    "recall_mode": "keyword_vector_retrieval"
                                },
                                "infos": {
                                    "knowledge_enhanced_information": {},
                                    "extra_info": ""
                                },
                                "input": "去年的业绩",
                                "action": "gen_exec"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "title": {
                                            "type": "string",
                                            "description": "查询标题"
                                        },
                                        "data": {
                                            "type": "array",
                                            "description": "查询结果数据",
                                            "items": {
                                                "type": "object"
                                            }
                                        },
                                        "data_desc": {
                                            "type": "object",
                                            "description": "数据描述信息",
                                            "properties": {
                                                "return_records_num": {
                                                    "type": "integer",
                                                    "description": "返回记录数"
                                                },
                                                "real_records_num": {
                                                    "type": "integer",
                                                    "description": "实际记录数"
                                                }
                                            }
                                        },
                                        "sql": {
                                            "type": "string",
                                            "description": "生成的SQL语句，基于用户输入的自然语言查询自动生成"
                                        },
                                        "explanation": {
                                            "type": "object",
                                            "description": "SQL解释说明，以字典形式展示查询条件、指标、维度等信息的业务含义"
                                        },
                                        "cites": {
                                            "type": "array",
                                            "description": "引用的数据视图列表，包含视图ID、名称、类型和描述等信息",
                                            "items": {
                                                "type": "object"
                                            }
                                        },
                                        "result_cache_key": {
                                            "type": "string",
                                            "description": "结果缓存键，用于从缓存中获取完整查询结果，前端可通过此键获取完整数据"
                                        }
                                    }
                                },
                                "example": {
                                    "output": {
                                        "sql": "SELECT ... FROM ... WHERE ... LIMIT 100",
                                        "explanation": {
                                            "XX 视图": [
                                                {
                                                    "指标": "XX 销量"
                                                },
                                                {
                                                    "日期": "XX 日期范围"
                                                },
                                                {
                                                    "品牌": "XX 品牌"
                                                }
                                            ]
                                        },
                                        "cites": [
                                            {
                                                "id": "VIEW_ID",
                                                "name": "XX 视图",
                                                "type": "data_view",
                                                "description": "XX 视图描述"
                                            }
                                        ],
                                        "data": [
                                            {
                                                "日期": "2024-01-01",
                                                "品牌": "XX 品牌",
                                                "销量": 200
                                            }
                                        ],
                                        "title": "XX 标题",
                                        "data_desc": {
                                            "return_records_num": 1,
                                            "real_records_num": 1
                                        },
                                        "result_cache_key": "RESULT_CACHE_KEY"
                                    },
                                    "tokens": "100",
                                    "time": "14.328890085220337"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/text2metric": {
            "post": {
                "summary": "text2metric",
                "description": "根据文本生成指标查询参数, 并查询指标数据",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "data_source": {
                                        "type": "object",
                                        "description": "数据源配置信息",
                                        "properties": {
                                            "metric_list": {
                                                "type": "array",
                                                "description": "指标ID列表",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "base_url": {
                                                "type": "string",
                                                "description": "服务器地址"
                                            },
                                            "token": {
                                                "type": "string",
                                                "description": "认证令牌"
                                            },
                                            "user_id": {
                                                "type": "string",
                                                "description": "用户ID"
                                            },
                                            "account_type": {
                                                "type": "string",
                                                "description": "调用者的类型，user 代表普通用户，app 代表应用账号，anonymous 代表匿名用户",
                                                "enum": [
                                                    "user",
                                                    "app",
                                                    "anonymous"
                                                ],
                                                "default": "user"
                                            },
                                            "kn": {
                                                "type": "array",
                                                "description": "知识网络配置参数",
                                                "items": {
                                                    "type": "object",
                                                    "properties": {
                                                        "knowledge_network_id": {
                                                            "type": "string",
                                                            "description": "知识网络ID"
                                                        },
                                                        "object_types": {
                                                            "type": "array",
                                                            "description": "知识网络对象类型",
                                                            "items": {
                                                                "type": "string"
                                                            }
                                                        }
                                                    },
                                                    "required": [
                                                        "knowledge_network_id"
                                                    ]
                                                }
                                            },
                                            "search_scope": {
                                                "type": "array",
                                                "description": "知识网络搜索范围，支持 object_types, relation_types, action_types",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "recall_mode": {
                                                "type": "string",
                                                "description": "召回模式，支持 keyword_vector_retrieval(默认), agent_intent_planning, agent_intent_retrieval",
                                                "enum": [
                                                    "keyword_vector_retrieval",
                                                    "agent_intent_planning",
                                                    "agent_intent_retrieval"
                                                ],
                                                "default": "keyword_vector_retrieval"
                                            }
                                        }
                                    },
                                    "inner_llm": {
                                        "type": "object",
                                        "description": "内部语言模型配置，用于指定内部使用的 LLM 模型参数，如模型ID、名称、温度、最大token数等。支持通过模型工厂配置模型"
                                    },
                                    "llm": {
                                        "type": "object",
                                        "description": "外部大语言模型配置，一般不需要配置，除非需要使用外部模型",
                                        "properties": {
                                            "model_name": {
                                                "type": "string",
                                                "description": "模型名称"
                                            },
                                            "openai_api_key": {
                                                "type": "string",
                                                "description": "OpenAI API密钥"
                                            },
                                            "openai_api_base": {
                                                "type": "string",
                                                "description": "OpenAI API基础URL"
                                            },
                                            "max_tokens": {
                                                "type": "integer",
                                                "description": "最大生成令牌数"
                                            },
                                            "temperature": {
                                                "type": "number",
                                                "description": "生成温度参数"
                                            }
                                        }
                                    },
                                    "config": {
                                        "type": "object",
                                        "description": "工具配置参数",
                                        "properties": {
                                            "background": {
                                                "type": "string",
                                                "description": "背景信息"
                                            },
                                            "session_type": {
                                                "type": "string",
                                                "description": "会话类型",
                                                "enum": [
                                                    "in_memory",
                                                    "redis"
                                                ],
                                                "default": "redis"
                                            },
                                            "session_id": {
                                                "type": "string",
                                                "description": "会话ID"
                                            },
                                            "force_limit": {
                                                "type": "integer",
                                                "description": "查询指标时，如果没有设置返回数据条数限制，在采用该参数设置的值作为限制, -1表示不限制, 系统默认为 1000",
                                                "default": 1000
                                            },
                                            "recall_top_k": {
                                                "type": "integer",
                                                "description": "指标召回数量限制，用于限制从数据源中召回的指标数量，-1表示不限制, 系统默认为 5",
                                                "default": 5
                                            },
                                            "dimension_num_limit": {
                                                "type": "integer",
                                                "description": "给大模型选择时维度数量限制，-1表示不限制, 系统默认为 30",
                                                "default": 30
                                            },
                                            "return_record_limit": {
                                                "type": "integer",
                                                "description": "结果返回时数据条数限制，-1表示不限制, 原因是指标查询执行后返回大量数据，可能导致大模型上下文token超限。系统默认为 100",
                                                "default": 100
                                            },
                                            "return_data_limit": {
                                                "type": "integer",
                                                "description": "结果返回时数据总量限制，单位是字节，-1表示不限制, 原因是指标查询执行后返回大量数据，可能导致大模型上下文token超限。系统默认为 5000",
                                                "default": 5000
                                            }
                                        }
                                    },
                                    "infos": {
                                        "type": "object",
                                        "description": "额外的输入信息, 包含额外信息和知识增强信息",
                                        "properties": {
                                            "knowledge_enhanced_information": {
                                                "type": "object",
                                                "description": "知识增强信息"
                                            },
                                            "extra_info": {
                                                "type": "string",
                                                "description": "额外信息(非知识增强)"
                                            }
                                        }
                                    },
                                    "input": {
                                        "type": "string",
                                        "description": "用户输入的自然语言查询"
                                    },
                                    "action": {
                                        "type": "string",
                                        "description": "操作类型：show_ds 显示数据源信息，query 执行查询（默认）",
                                        "enum": [
                                            "show_ds",
                                            "query"
                                        ],
                                        "default": "query"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "请求超时时间（秒），超过此时间未完成则返回超时错误，默认120秒",
                                        "default": 120
                                    }
                                },
                                "required": [
                                    "data_source",
                                    "input"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "title": {
                                            "type": "string",
                                            "description": "查询标题"
                                        },
                                        "data": {
                                            "type": "array",
                                            "description": "查询结果数据",
                                            "items": {
                                                "type": "object"
                                            }
                                        },
                                        "data_desc": {
                                            "type": "object",
                                            "description": "数据描述信息",
                                            "properties": {
                                                "return_records_num": {
                                                    "type": "integer",
                                                    "description": "返回记录数"
                                                },
                                                "real_records_num": {
                                                    "type": "integer",
                                                    "description": "实际记录数"
                                                }
                                            }
                                        },
                                        "metric_id": {
                                            "type": "string",
                                            "description": "选择的指标ID，基于用户输入自动匹配并选择的指标标识符"
                                        },
                                        "query_params": {
                                            "type": "object",
                                            "description": "生成的查询参数，包含时间范围、过滤条件、步长等指标查询所需的参数"
                                        },
                                        "explanation": {
                                            "type": "object",
                                            "description": "查询解释说明，以字典形式展示指标选择、时间范围、过滤条件等信息的业务含义"
                                        },
                                        "cites": {
                                            "type": "array",
                                            "description": "引用的指标列表，包含指标ID、名称、类型等信息",
                                            "items": {
                                                "type": "object"
                                            }
                                        },
                                        "result_cache_key": {
                                            "type": "string",
                                            "description": "结果缓存键，用于从缓存中获取完整查询结果，前端可通过此键获取完整数据"
                                        },
                                        "execution_result": {
                                            "type": "object",
                                            "description": "指标执行结果详情，包含指标元信息、数据摘要、样例数据等"
                                        }
                                    }
                                },
                                "example": {
                                    "output": {
                                        "metric_id": "cpu_usage_metric",
                                        "query_params": {
                                            "instant": false,
                                            "start": 1646360670123,
                                            "end": 1646471470123,
                                            "step": "1m",
                                            "filters": [
                                                {
                                                    "name": "labels.host",
                                                    "value": [
                                                        "server-1",
                                                        "server-2"
                                                    ],
                                                    "operation": "in"
                                                }
                                            ]
                                        },
                                        "explanation": {
                                            "CPU使用率": [
                                                {
                                                    "指标": "使用 'CPU使用率' 指标，按 '时间' '最近1小时' 的数据，并设置过滤条件 '主机为server-1和server-2'"
                                                },
                                                {
                                                    "时间": "从 2024-01-01 到 2024-01-02"
                                                },
                                                {
                                                    "主机": "包含 server-1, server-2"
                                                }
                                            ]
                                        },
                                        "cites": [
                                            {
                                                "id": "cpu_usage_metric",
                                                "name": "CPU使用率",
                                                "type": "metric",
                                                "description": "CPU使用率指标"
                                            }
                                        ],
                                        "data": [
                                            {
                                                "时间": "2024-01-01 10:00:00",
                                                "主机": "server-1",
                                                "CPU使用率": 75.5
                                            },
                                            {
                                                "时间": "2024-01-01 10:01:00",
                                                "主机": "server-1",
                                                "CPU使用率": 78.2
                                            }
                                        ],
                                        "title": "最近1小时CPU使用率",
                                        "data_desc": {
                                            "return_records_num": 2,
                                            "real_records_num": 120
                                        },
                                        "execution_result": {
                                            "success": true,
                                            "model_info": {
                                                "id": "cpu_usage_metric",
                                                "name": "CPU使用率",
                                                "metric_type": "atomic",
                                                "query_type": "dsl",
                                                "unit": "%"
                                            },
                                            "data_summary": {
                                                "total_data_points": 120,
                                                "step": "1m",
                                                "is_variable": false,
                                                "is_calendar": false
                                            },
                                            "sample_data": [
                                                {
                                                    "index": 1,
                                                    "labels": {
                                                        "host": "server-1"
                                                    },
                                                    "time_points": 120,
                                                    "value_points": 120,
                                                    "sample_times": [
                                                        1646360670123,
                                                        1646360730123
                                                    ],
                                                    "sample_values": [
                                                        75.5,
                                                        78.2
                                                    ]
                                                }
                                            ]
                                        },
                                        "result_cache_key": "cpu_usage_metric_1646360670123_1646471470123"
                                    },
                                    "time": "2.5",
                                    "tokens": "150"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/sql_helper": {
            "post": {
                "summary": "sql_helper",
                "description": "专门用于调用 SQL 语句的工具，支持获取元数据信息和执行 SQL 语句。注意：此工具不生成 SQL 语句，只执行已提供的 SQL 语句。",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "data_source": {
                                        "type": "object",
                                        "description": "数据源配置信息",
                                        "properties": {
                                            "view_list": {
                                                "type": "array",
                                                "description": "逻辑视图ID列表",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "base_url": {
                                                "type": "string",
                                                "description": "服务器地址，用于连接数据源服务"
                                            },
                                            "token": {
                                                "type": "string",
                                                "description": "认证令牌，如提供则无需用户名和密码"
                                            },
                                            "user_id": {
                                                "type": "string",
                                                "description": "用户ID"
                                            },
                                            "account_type": {
                                                "type": "string",
                                                "description": "调用者的类型，user 代表普通用户，app 代表应用账号, anonymous 代表匿名用户",
                                                "enum": [
                                                    "user",
                                                    "app",
                                                    "anonymous"
                                                ],
                                                "default": "user"
                                            },
                                            "kn": {
                                                "type": "array",
                                                "description": "知识网络配置参数，用于从知识网络中获取数据源",
                                                "items": {
                                                    "type": "object",
                                                    "properties": {
                                                        "knowledge_network_id": {
                                                            "type": "string",
                                                            "description": "知识网络ID"
                                                        },
                                                        "object_types": {
                                                            "type": "array",
                                                            "description": "知识网络对象类型",
                                                            "items": {
                                                                "type": "string"
                                                            }
                                                        }
                                                    },
                                                    "required": [
                                                        "knowledge_network_id"
                                                    ]
                                                }
                                            },
                                            "search_scope": {
                                                "type": "array",
                                                "description": "知识网络搜索范围，支持 object_types, relation_types, action_types",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "recall_mode": {
                                                "type": "string",
                                                "description": "召回模式，支持 keyword_vector_retrieval(默认), agent_intent_planning, agent_intent_retrieval",
                                                "enum": [
                                                    "keyword_vector_retrieval",
                                                    "agent_intent_planning",
                                                    "agent_intent_retrieval"
                                                ],
                                                "default": "keyword_vector_retrieval"
                                            }
                                        },
                                        "required": []
                                    },
                                    "config": {
                                        "type": "object",
                                        "description": "工具配置参数",
                                        "properties": {
                                            "session_type": {
                                                "type": "string",
                                                "description": "会话类型",
                                                "enum": [
                                                    "in_memory",
                                                    "redis"
                                                ],
                                                "default": "redis"
                                            },
                                            "session_id": {
                                                "type": "string",
                                                "description": "会话ID，用于标识和管理会话状态，同一会话ID可以共享历史数据和缓存"
                                            },
                                            "view_num_limit": {
                                                "type": "integer",
                                                "description": "获取元数据时引用视图数量限制，-1表示不限制，原因是数据源包含大量视图，可能导致大模型上下文token超限，内置的召回算法会自动筛选最相关的视图。系统默认为 5。注意：此参数仅在 command 为 get_metadata 时有效，在 command 为 execute_sql 时无效，因为工具会严格执行 SQL，不会限制视图数量",
                                                "default": 5
                                            },
                                            "dimension_num_limit": {
                                                "type": "integer",
                                                "description": "获取元数据时维度数量限制，-1表示不限制, 系统默认为 30。注意：此参数仅在 command 为 get_metadata 时有效，在 command 为 execute_sql 时无效，因为工具会严格执行 SQL，不会限制维度数量",
                                                "default": 30
                                            },
                                            "return_record_limit": {
                                                "type": "integer",
                                                "description": "SQL 执行后返回数据条数限制，-1表示不限制，原因是SQL执行后返回大量数据，可能导致大模型上下文token超限。系统默认为 100。注意：此参数在 command 为 execute_sql 时有效，用于限制返回结果的数据条数",
                                                "default": 100
                                            },
                                            "return_data_limit": {
                                                "type": "integer",
                                                "description": "SQL 执行后返回数据总量限制，单位是字节，-1表示不限制，原因是SQL执行后返回大量数据，可能导致大模型上下文token超限。系统默认为 5000。注意：此参数在 command 为 execute_sql 时有效，用于限制返回结果的数据大小",
                                                "default": 5000
                                            },
                                            "force_limit": {
                                                "type": "integer",
                                                "description": "强制限制SQL查询的行数。在SQL执行前，工具会将原始SQL包装为子查询并添加 LIMIT 子句，限制返回的数据条数。系统默认为 200。如果设置为 0 或负数，则不添加 LIMIT 限制。注意：此参数仅在 command 为 execute_sql 时有效，在 SQL 执行前生效，会影响实际查询的数据量",
                                                "default": 200
                                            },
                                            "with_sample": {
                                                "type": "boolean",
                                                "description": "查询元数据时是否包含样例数据",
                                                "default": true
                                            }
                                        }
                                    },
                                    "command": {
                                        "type": "string",
                                        "description": "命令类型，其中 get_metadata 表示获取元数据信息，execute_sql 表示执行 SQL 语句",
                                        "enum": [
                                            "get_metadata",
                                            "execute_sql"
                                        ],
                                        "default": "execute_sql"
                                    },
                                    "sql": {
                                        "type": "string",
                                        "description": "要执行的 SQL 语句，当 command 为 execute_sql 时必填"
                                    },
                                    "title": {
                                        "type": "string",
                                        "description": "数据的标题，获取元数据则必填"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "请求超时时间（秒），超过此时间未完成则返回超时错误，默认120秒",
                                        "default": 120
                                    },
                                    "with_sample": {
                                        "type": "boolean",
                                        "description": "查询元数据时是否包含样例数据",
                                        "default": true
                                    }
                                },
                                "required": [
                                    "data_source",
                                    "command"
                                ]
                            },
                            "example": {
                                "data_source": {
                                    "view_list": [
                                        "view_id"
                                    ],
                                    "base_url": "https://xxxxx",
                                    "token": "",
                                    "user_id": "",
                                    "account_type": "user",
                                    "kn": [
                                        {
                                            "knowledge_network_id": "129",
                                            "object_types": [
                                                "data_view",
                                                "metric"
                                            ]
                                        }
                                    ],
                                    "search_scope": [
                                        "object_types",
                                        "relation_types",
                                        "action_types"
                                    ],
                                    "recall_mode": "keyword_vector_retrieval"
                                },
                                "config": {
                                    "session_type": "redis",
                                    "session_id": "123",
                                    "return_record_limit": 10,
                                    "return_data_limit": 1000,
                                    "get_desc_from_datasource": false,
                                    "with_sample": true,
                                    "view_num_limit": 5,
                                    "dimension_num_limit": 30,
                                    "force_limit": 200
                                },
                                "command": "execute_sql",
                                "sql": "SELECT * FROM table LIMIT 10",
                                "title": "数据的标题",
                                "timeout": 120
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "command": {
                                            "type": "string",
                                            "description": "执行的命令类型"
                                        },
                                        "sql": {
                                            "type": "string",
                                            "description": "执行的SQL语句"
                                        },
                                        "title": {
                                            "type": "string",
                                            "description": "数据的标题"
                                        },
                                        "data": {
                                            "type": "array",
                                            "description": "查询结果数据",
                                            "items": {
                                                "type": "object"
                                            }
                                        },
                                        "data_desc": {
                                            "type": "object",
                                            "description": "数据描述信息",
                                            "properties": {
                                                "return_records_num": {
                                                    "type": "integer",
                                                    "description": "返回记录数"
                                                },
                                                "real_records_num": {
                                                    "type": "integer",
                                                    "description": "实际记录数"
                                                }
                                            }
                                        },
                                        "message": {
                                            "type": "string",
                                            "description": "执行结果消息"
                                        },
                                        "result_cache_key": {
                                            "type": "string",
                                            "description": "结果缓存键，用于从缓存中获取完整查询结果，前端可通过此键获取完整数据"
                                        },
                                        "metadata": {
                                            "type": "object",
                                            "description": "元数据信息，当 command 为 get_metadata 时返回"
                                        },
                                        "sample": {
                                            "type": "object",
                                            "description": "样例数据，当 command 为 get_metadata 且 with_sample 为 true 时返回"
                                        },
                                        "summary": {
                                            "type": "array",
                                            "description": "数据源摘要信息，当 command 为 get_metadata 时返回",
                                            "items": {
                                                "type": "object"
                                            }
                                        }
                                    }
                                },
                                "example": {
                                    "output": {
                                        "command": "execute_sql",
                                        "sql": "SELECT * FROM table LIMIT 10",
                                        "data": [
                                            {
                                                "column1": "value1",
                                                "column2": "value2"
                                            }
                                        ],
                                        "data_desc": {
                                            "return_records_num": 1,
                                            "real_records_num": 1
                                        },
                                        "message": "SQL 执行成功",
                                        "result_cache_key": "RESULT_CACHE_KEY"
                                    },
                                    "tokens": "100",
                                    "time": "14.328890085220337"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/knowledge_item": {
            "post": {
                "summary": "knowledge_item",
                "description": "根据输入的文本，获取知识条目信息，知识条目可用于为其他工具提供背景知识",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "data_source": {
                                        "type": "object",
                                        "description": "数据源配置信息",
                                        "properties": {
                                            "data_item_ids": {
                                                "type": "array",
                                                "description": "知识条目ID列表",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "base_url": {
                                                "type": "string",
                                                "description": "服务器地址"
                                            },
                                            "token": {
                                                "type": "string",
                                                "description": "认证令牌"
                                            },
                                            "user_id": {
                                                "type": "string",
                                                "description": "用户ID"
                                            },
                                            "account_type": {
                                                "type": "string",
                                                "description": "用户类型",
                                                "default": "user",
                                                "enum": [
                                                    "user",
                                                    "app",
                                                    "anonymous"
                                                ]
                                            }
                                        },
                                        "required": [
                                            "data_item_ids"
                                        ]
                                    },
                                    "input": {
                                        "type": "string",
                                        "description": "用户需要查询的文本"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "超时时间",
                                        "default": 30
                                    },
                                    "config": {
                                        "type": "object",
                                        "description": "工具配置参数",
                                        "properties": {
                                            "return_record_limit": {
                                                "type": "integer",
                                                "description": "每个知识条目返回数据条数限制，-1 代表不限制",
                                                "default": 30
                                            },
                                            "return_data_limit": {
                                                "type": "integer",
                                                "description": "每个知识条目返回数据总量限制，-1 代表不限制",
                                                "default": -1
                                            },
                                            "knowledge_item_limit": {
                                                "type": "integer",
                                                "description": "知识条目个数限制，-1 代表不限制，默认 5",
                                                "default": 5
                                            }
                                        }
                                    }
                                },
                                "required": [
                                    "data_source"
                                ]
                            },
                            "example": {
                                "data_source": {
                                    "data_item_ids": [
                                        "data_item_id"
                                    ],
                                    "base_url": "https://xxxxx",
                                    "token": "",
                                    "user_id": "",
                                    "account_type": "user"
                                },
                                "input": "用户需要查询的文本"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "output": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "name": {
                                                        "type": "string",
                                                        "description": "知识条目名称"
                                                    },
                                                    "comment": {
                                                        "type": "string",
                                                        "description": "知识条目描述"
                                                    },
                                                    "type": {
                                                        "type": "string",
                                                        "description": "知识条目类型"
                                                    },
                                                    "items": {
                                                        "oneOf": [
                                                            {
                                                                "type": "object",
                                                                "description": "键值对类型知识条目",
                                                                "additionalProperties": {
                                                                    "type": "string"
                                                                }
                                                            },
                                                            {
                                                                "type": "array",
                                                                "description": "列表类型知识条目",
                                                                "items": {
                                                                    "type": "object",
                                                                    "properties": {
                                                                        "key": {
                                                                            "type": "string",
                                                                            "description": "知识条目键"
                                                                        },
                                                                        "value": {
                                                                            "type": "string",
                                                                            "description": "知识条目值"
                                                                        },
                                                                        "comment": {
                                                                            "type": "string",
                                                                            "description": "知识条目描述"
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    "data_summary": {
                                                        "type": "object",
                                                        "properties": {
                                                            "return_data_num": {
                                                                "type": "integer",
                                                                "description": "返回数据条数"
                                                            },
                                                            "real_data_num": {
                                                                "type": "integer",
                                                                "description": "实际数据条数"
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                },
                                "example": {
                                    "output": [
                                        {
                                            "name": "知识条目名称",
                                            "comment": "知识条目描述",
                                            "type": "kv_dict",
                                            "items": {
                                                "key1": "value1",
                                                "key2": "value2"
                                            },
                                            "data_summary": {
                                                "return_data_num": 2,
                                                "real_data_num": 10
                                            }
                                        },
                                        {
                                            "name": "列表类型知识条目",
                                            "comment": "知识条目描述",
                                            "type": "list",
                                            "items": [
                                                {
                                                    "key": "知识条目名称",
                                                    "value": "知识条目值",
                                                    "comment": "知识条目描述"
                                                }
                                            ],
                                            "data_summary": {
                                                "return_data_num": 1,
                                                "real_data_num": 5
                                            }
                                        }
                                    ],
                                    "tokens": "100",
                                    "time": "14.328890085220337"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/get_metadata": {
            "post": {
                "summary": "get_metadata",
                "description": "获取数据视图和指标的元数据信息，支持从知识网络(kn)中获取数据源",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "data_source": {
                                        "type": "object",
                                        "description": "数据源配置信息",
                                        "properties": {
                                            "base_url": {
                                                "type": "string",
                                                "description": "服务器地址"
                                            },
                                            "token": {
                                                "type": "string",
                                                "description": "认证令牌"
                                            },
                                            "user_id": {
                                                "type": "string",
                                                "description": "用户ID"
                                            },
                                            "account_type": {
                                                "type": "string",
                                                "description": "调用者的类型，user 代表普通用户，app 代表应用账号，anonymous 代表匿名用户",
                                                "enum": [
                                                    "user",
                                                    "app",
                                                    "anonymous"
                                                ],
                                                "default": "user"
                                            },
                                            "view_list": {
                                                "type": "array",
                                                "description": "数据视图ID列表",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "metric_list": {
                                                "type": "array",
                                                "description": "指标ID列表",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "kn": {
                                                "type": "array",
                                                "description": "知识网络配置参数（新版本），用于从知识网络中获取数据源。注意：kn 可以获取数据视图（data_view）和指标（metric）",
                                                "items": {
                                                    "type": "object",
                                                    "properties": {
                                                        "knowledge_network_id": {
                                                            "type": "string",
                                                            "description": "知识网络ID"
                                                        },
                                                        "object_types": {
                                                            "type": "array",
                                                            "description": "知识网络对象类型",
                                                            "items": {
                                                                "type": "string"
                                                            }
                                                        }
                                                    },
                                                    "required": [
                                                        "knowledge_network_id"
                                                    ]
                                                }
                                            },
                                            "search_scope": {
                                                "type": "array",
                                                "description": "知识网络搜索范围，支持 object_types, relation_types, action_types",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "recall_mode": {
                                                "type": "string",
                                                "description": "召回模式，支持 keyword_vector_retrieval(默认), agent_intent_planning, agent_intent_retrieval",
                                                "enum": [
                                                    "keyword_vector_retrieval",
                                                    "agent_intent_planning",
                                                    "agent_intent_retrieval"
                                                ],
                                                "default": "keyword_vector_retrieval"
                                            }
                                        }
                                    },
                                    "config": {
                                        "type": "object",
                                        "description": "工具配置参数",
                                        "properties": {
                                            "with_sample": {
                                                "type": "boolean",
                                                "description": "是否获取数据样例",
                                                "default": false
                                            },
                                            "data_source_num_limit": {
                                                "type": "integer",
                                                "description": "数据源数量限制，-1表示不限制",
                                                "default": -1
                                            },
                                            "dimension_num_limit": {
                                                "type": "integer",
                                                "description": "维度数量限制，-1表示不限制, 系统默认为 30",
                                                "default": 30
                                            },
                                            "ds_type": {
                                                "type": "string",
                                                "description": "数据源类型过滤，data_view 表示只获取数据视图，metric 表示只获取指标，all 或不指定则获取所有类型",
                                                "enum": [
                                                    "data_view",
                                                    "metric",
                                                    "all"
                                                ]
                                            },
                                            "session_type": {
                                                "type": "string",
                                                "description": "会话类型",
                                                "enum": [
                                                    "in_memory",
                                                    "redis"
                                                ],
                                                "default": "redis"
                                            },
                                            "session_id": {
                                                "type": "string",
                                                "description": "会话ID"
                                            }
                                        }
                                    },
                                    "query": {
                                        "type": "string",
                                        "description": "查询语句，用于从知识网络中检索相关数据源"
                                    },
                                    "with_sample": {
                                        "type": "boolean",
                                        "description": "是否获取数据样例",
                                        "default": false
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "请求超时时间（秒），超过此时间未完成则返回超时错误，默认120秒",
                                        "default": 120
                                    }
                                },
                                "required": [
                                    "data_source"
                                ]
                            },
                            "example": {
                                "data_source": {
                                    "view_list": [
                                        "view_id_1",
                                        "view_id_2"
                                    ],
                                    "metric_list": [
                                        "metric_id_1",
                                        "metric_id_2"
                                    ],
                                    "base_url": "https://xxxxx",
                                    "token": "",
                                    "user_id": "",
                                    "account_type": "user",
                                    "kn": [
                                        {
                                            "knowledge_network_id": "kn_id_1"
                                        }
                                    ],
                                    "search_scope": [
                                        "object_types",
                                        "relation_types",
                                        "action_types"
                                    ],
                                    "recall_mode": "keyword_vector_retrieval"
                                },
                                "config": {
                                    "with_sample": false,
                                    "data_source_num_limit": 10,
                                    "dimension_num_limit": 30,
                                    "session_type": "redis",
                                    "session_id": "123"
                                },
                                "query": "查询数据视图和指标的元数据",
                                "ds_type": "data_view",
                                "with_sample": false
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "data_view_metadata": {
                                            "type": "object",
                                            "description": "数据视图元数据，key 为数据视图ID，value 为元数据信息"
                                        },
                                        "metric_metadata": {
                                            "type": "object",
                                            "description": "指标元数据，key 为指标ID，value 为元数据信息"
                                        },
                                        "data_view_summary": {
                                            "type": "array",
                                            "description": "数据视图摘要列表",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "name": {
                                                        "type": "string",
                                                        "description": "数据视图名称"
                                                    },
                                                    "comment": {
                                                        "type": "string",
                                                        "description": "数据视图描述"
                                                    },
                                                    "table_path": {
                                                        "type": "string",
                                                        "description": "数据视图路径"
                                                    }
                                                }
                                            }
                                        },
                                        "metric_summary": {
                                            "type": "array",
                                            "description": "指标摘要列表",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "name": {
                                                        "type": "string",
                                                        "description": "指标名称"
                                                    },
                                                    "comment": {
                                                        "type": "string",
                                                        "description": "指标描述"
                                                    },
                                                    "id": {
                                                        "type": "string",
                                                        "description": "指标ID"
                                                    }
                                                }
                                            }
                                        },
                                        "title": {
                                            "type": "string",
                                            "description": "结果标题"
                                        },
                                        "errors": {
                                            "type": "array",
                                            "description": "错误信息列表（如果存在）",
                                            "items": {
                                                "type": "string"
                                            }
                                        }
                                    }
                                },
                                "example": {
                                    "data_view_metadata": {
                                        "view_id_1": {
                                            "id": "view_id_1",
                                            "name": "数据视图名称",
                                            "comment": "数据视图描述",
                                            "fields": [
                                                {
                                                    "name": "字段名",
                                                    "type": "string",
                                                    "comment": "字段描述"
                                                }
                                            ]
                                        }
                                    },
                                    "metric_metadata": {
                                        "metric_id_1": {
                                            "id": "metric_id_1",
                                            "name": "指标名称",
                                            "comment": "指标描述",
                                            "formula_config": {},
                                            "analysis_dimensions": []
                                        }
                                    },
                                    "data_view_summary": [
                                        {
                                            "name": "数据视图名称",
                                            "comment": "数据视图描述",
                                            "table_path": "catalog.schema.table"
                                        }
                                    ],
                                    "metric_summary": [
                                        {
                                            "name": "指标名称",
                                            "comment": "指标描述",
                                            "id": "metric_id_1"
                                        }
                                    ],
                                    "title": "获取数据源信息"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/json2plot": {
            "post": {
                "summary": "json2plot",
                "description": "根据绘图参数生成用于前端展示的 JSON 对象。如果包含此工具，则优先使用此工具绘图\n\n调用方法是 `json2plot(title, chart_type, group_by, data_field, tool_result_cache_key)`\n\n**注意：**\n- 你拿到结果后, 不需要给用户展示这个 JSON 对象, 前端会自动画图",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "title": {
                                        "type": "string",
                                        "description": "和数据的 title 保持一致, 是一个字符串, **不是dict**"
                                    },
                                    "chart_type": {
                                        "type": "string",
                                        "enum": [
                                            "Pie",
                                            "Line",
                                            "Column"
                                        ],
                                        "description": "图表的类型, 输出仅支持三种: Pie, Line, Column, 环形图也属于 Pie"
                                    },
                                    "group_by": {
                                        "type": "array",
                                        "description": "\n分组字段列表，支持多个字段，如果有时间字段，请放在第一位。另外:\n- 对于折线图, group_by 可能有1~2个值, 第一个是 x 轴, 第二个字段是 分组, data_field 是 y 轴\n- 对于柱状图, group_by 可能有1~3个值, 第一个是 x 轴, 第二个字段是 堆叠, 第三个字段是 分组, data_field 是 y 轴\n- 对于饼图, group_by 只有一个值, 即 colorField, data_field 是 angleField\n",
                                        "items": {
                                            "type": "string"
                                        }
                                    },
                                    "data_field": {
                                        "type": "string",
                                        "description": "数据字段，注意设置的 group_by 和 data_field 必须和数据匹配，不要自己生成，如果数据中没有，可以询问用户"
                                    },
                                    "tool_result_cache_key": {
                                        "type": "string",
                                        "description": "text2metric 或 text2sql工具缓存 key, 其他工具的结果没有意义，key 是一个字符串, 与 data 不能同时设置"
                                    },
                                    "session_id": {
                                        "type": "string",
                                        "description": "会话ID，用于标识和管理会话状态，同一会话ID可以共享历史数据和缓存"
                                    },
                                    "session_type": {
                                        "type": "string",
                                        "enum": [
                                            "in_memory",
                                            "redis"
                                        ],
                                        "description": "会话类型，in_memory 表示内存存储（临时），redis 表示 Redis 存储（持久化）",
                                        "default": "redis"
                                    },
                                    "data": {
                                        "type": "array",
                                        "description": "用于作图的 JSON 数据，与 tool_result_cache_key 参数不能同时设置。如果 tool_result_cache_key 为空，则使用此参数。数据格式为对象数组，每个对象表示一条数据记录",
                                        "items": {
                                            "type": "object",
                                            "additionalProperties": {
                                                "type": [
                                                    "string",
                                                    "number"
                                                ]
                                            }
                                        }
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "请求超时时间（秒），超过此时间未完成则返回超时错误，默认30秒",
                                        "default": 30
                                    }
                                },
                                "required": [
                                    "title",
                                    "chart_type",
                                    "group_by",
                                    "data_field"
                                ],
                                "example": {
                                    "title": "2024年1月1日到2024年1月3日，每天的销售额",
                                    "chart_type": "Line",
                                    "group_by": [
                                        "报告时间(按年)"
                                    ],
                                    "data_field": "营收收入指标",
                                    "tool_result_cache_key": "",
                                    "session_id": "123",
                                    "session_type": "in_memory",
                                    "data": []
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "config": {
                                            "type": "object",
                                            "description": "基础图表配置，包含图表类型、坐标轴字段等基础信息"
                                        },
                                        "chart_config": {
                                            "type": "object",
                                            "description": "详细图表配置，包含完整的图表渲染参数，如 xField（X轴字段）、yField（Y轴字段）、seriesField（系列字段）、groupField（分组字段）等"
                                        },
                                        "title": {
                                            "type": "string",
                                            "description": "图表标题，用于前端展示"
                                        },
                                        "result_cache_key": {
                                            "type": "string",
                                            "description": "结果缓存键，用于从缓存中获取完整数据，前端可通过此键获取完整图表数据"
                                        },
                                        "data_sample": {
                                            "type": "array",
                                            "description": "数据样例，仅返回第一条数据用于预览，完整数据需通过 result_cache_key 从缓存获取",
                                            "items": {
                                                "type": "object"
                                            }
                                        }
                                    }
                                },
                                "example": {
                                    "output": {
                                        "config": {
                                            "chart_type": "Column",
                                            "xField": "报告时间(按年)",
                                            "yField": "营收收入指标",
                                            "colorField": "",
                                            "angleField": ""
                                        },
                                        "chart_config": {
                                            "xField": "报告时间(按年)",
                                            "yField": "营收收入指标",
                                            "seriesField": "报告类型",
                                            "chart_type": "Column",
                                            "groupField": ""
                                        },
                                        "title": "2024年1月1日到2024年1月3日，每天的销售额",
                                        "result_cache_key": "CACHE_KEY",
                                        "data_sample": [
                                            {
                                                "报告类型": "一季报",
                                                "报告时间(按年)": "2015",
                                                "营收收入指标": 12312312
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/execute_code": {
            "post": {
                "summary": "execute_code",
                "description": "在沙箱环境中执行 Python 代码，支持 pandas 等数据分析库，注意沙箱环境是受限环境，没有网络连接，不能使用 pip 安装第三方库。运行代码时，需要通过 print 输出结果，或者设置输出变量 output_params 参数，返回结果",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "server_url": {
                                        "type": "string",
                                        "description": "可选，沙箱服务器URL，默认使用配置文件中的 SANDBOX_URL",
                                        "default": "http://sandbox-runtime:9101"
                                    },
                                    "session_id": {
                                        "type": "string",
                                        "description": "沙箱会话ID"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "超时时间",
                                        "default": 120
                                    },
                                    "title": {
                                        "type": "string",
                                        "description": "对于当前操作的简单描述，便于用户理解"
                                    },
                                    "content": {
                                        "type": "string",
                                        "description": "要执行的 Python 代码内容"
                                    },
                                    "filename": {
                                        "type": "string",
                                        "description": "文件名，用于指定代码文件的名称"
                                    },
                                    "args": {
                                        "type": "array",
                                        "items": {
                                            "type": "string"
                                        },
                                        "description": "代码执行参数"
                                    },
                                    "output_params": {
                                        "type": "array",
                                        "items": {
                                            "type": "string"
                                        },
                                        "description": "输出参数列表，用于指定要返回的变量名"
                                    }
                                },
                                "required": [
                                    "content"
                                ]
                            },
                            "examples": {
                                "basic_execution": {
                                    "summary": "基础代码执行",
                                    "description": "执行简单的 Python 代码",
                                    "value": {
                                        "content": "print('Hello World')\nx = 10\ny = 20\nresult = x + y\nprint(f'{x} + {y} = {result}')",
                                        "filename": "hello.py",
                                        "output_params": [
                                            "result"
                                        ],
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                },
                                "data_analysis": {
                                    "summary": "数据分析示例",
                                    "description": "使用 pandas 进行数据分析",
                                    "value": {
                                        "content": "import pandas as pd\nimport numpy as np\n\n# 创建示例数据\ndata = {\n    'name': ['Alice', 'Bob', 'Charlie'],\n    'age': [25, 30, 35],\n    'salary': [50000, 60000, 70000]\n}\ndf = pd.DataFrame(data)\n\n# 计算统计信息\nstats = {\n    'mean_age': df['age'].mean(),\n    'mean_salary': df['salary'].mean(),\n    'total_records': len(df)\n}\n\nprint('数据统计:')\nfor key, value in stats.items():\n    print(f'{key}: {value}')\n\nresult = stats",
                                        "filename": "data_analysis.py",
                                        "output_params": [
                                            "result",
                                            "df"
                                        ],
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "result": {
                                            "type": "object",
                                            "description": "操作结果, 包含标准输出、标准错误输出、返回值"
                                        },
                                        "message": {
                                            "type": "string",
                                            "description": "操作状态消息"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "description": "错误信息"
                                        },
                                        "detail": {
                                            "type": "string",
                                            "description": "详细错误信息"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/execute_command": {
            "post": {
                "summary": "execute_command",
                "description": "在沙箱环境中执行系统命令，如 ls、cat、grep 等 Linux 命令",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "server_url": {
                                        "type": "string",
                                        "description": "可选，沙箱服务器URL，默认使用配置文件中的 SANDBOX_URL",
                                        "default": "http://sandbox-runtime:9101"
                                    },
                                    "session_id": {
                                        "type": "string",
                                        "description": "沙箱会话ID"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "超时时间",
                                        "default": 120
                                    },
                                    "title": {
                                        "type": "string",
                                        "description": "对于当前操作的简单描述，便于用户理解"
                                    },
                                    "command": {
                                        "type": "string",
                                        "description": "要执行的系统命令"
                                    },
                                    "args": {
                                        "type": "array",
                                        "items": {
                                            "type": "string"
                                        },
                                        "description": "命令参数列表"
                                    }
                                },
                                "required": [
                                    "command"
                                ]
                            },
                            "examples": {
                                "list_files": {
                                    "summary": "列出文件",
                                    "description": "列出当前目录下的所有文件",
                                    "value": {
                                        "command": "ls",
                                        "args": [
                                            "-la"
                                        ],
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                },
                                "view_file": {
                                    "summary": "查看文件内容",
                                    "description": "查看指定文件的内容",
                                    "value": {
                                        "command": "cat",
                                        "args": [
                                            "hello.py"
                                        ],
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                },
                                "search_content": {
                                    "summary": "搜索内容",
                                    "description": "在文件中搜索指定内容",
                                    "value": {
                                        "command": "grep",
                                        "args": [
                                            "-n",
                                            "print",
                                            "*.py"
                                        ],
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "result": {
                                            "type": "object",
                                            "description": "操作结果, 包含标准输出、标准错误输出、返回值"
                                        },
                                        "message": {
                                            "type": "string",
                                            "description": "操作状态消息"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "description": "错误信息"
                                        },
                                        "detail": {
                                            "type": "string",
                                            "description": "详细错误信息"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/read_file": {
            "post": {
                "summary": "read_file",
                "description": "读取沙箱环境中的文件内容，支持文本文件和二进制文件",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "server_url": {
                                        "type": "string",
                                        "description": "可选，沙箱服务器URL，默认使用配置文件中的 SANDBOX_URL",
                                        "default": "http://sandbox-runtime:9101"
                                    },
                                    "session_id": {
                                        "type": "string",
                                        "description": "沙箱会话ID"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "超时时间",
                                        "default": 120
                                    },
                                    "title": {
                                        "type": "string",
                                        "description": "对于当前操作的简单描述，便于用户理解"
                                    },
                                    "filename": {
                                        "type": "string",
                                        "description": "要读取的文件名"
                                    },
                                    "session_type": {
                                        "type": "string",
                                        "description": "会话类型, 可选值为: redis, in_memory, 默认值为 redis"
                                    }
                                },
                                "required": [
                                    "filename"
                                ]
                            },
                            "examples": {
                                "read_python_file": {
                                    "summary": "读取 Python 文件",
                                    "description": "读取 Python 源代码文件",
                                    "value": {
                                        "filename": "hello.py",
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "result": {
                                            "type": "object",
                                            "description": "操作结果, 包含标准输出、标准错误输出、返回值"
                                        },
                                        "message": {
                                            "type": "string",
                                            "description": "操作状态消息"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "description": "错误信息"
                                        },
                                        "detail": {
                                            "type": "string",
                                            "description": "详细错误信息"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/create_file": {
            "post": {
                "summary": "create_file",
                "description": "在沙箱环境中创建新文件，支持文本内容或从缓存中获取内容",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "server_url": {
                                        "type": "string",
                                        "description": "可选，沙箱服务器URL，默认使用配置文件中的 SANDBOX_URL",
                                        "default": "http://sandbox-runtime:9101"
                                    },
                                    "session_id": {
                                        "type": "string",
                                        "description": "沙箱会话ID"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "超时时间",
                                        "default": 120
                                    },
                                    "title": {
                                        "type": "string",
                                        "description": "对于当前操作的简单描述，便于用户理解"
                                    },
                                    "content": {
                                        "type": "string",
                                        "description": "文件内容, 如果 result_cache_key 参数不为空，则无需设置该参数"
                                    },
                                    "filename": {
                                        "type": "string",
                                        "description": "要创建的文件名"
                                    },
                                    "session_type": {
                                        "type": "string",
                                        "description": "会话类型, 可选值为: redis, in_memory, 默认值为 redis"
                                    },
                                    "result_cache_key": {
                                        "type": "string",
                                        "description": "之前工具的结果缓存key，可以用于将结果写入到文件中，有此参数则无需设置 content 参数"
                                    }
                                },
                                "required": [
                                    "filename"
                                ]
                            },
                            "examples": {
                                "create_python_file": {
                                    "summary": "创建 Python 文件",
                                    "description": "创建包含 Python 代码的文件",
                                    "value": {
                                        "content": "def fibonacci(n):\n    if n <= 1:\n        return n\n    return fibonacci(n-1) + fibonacci(n-2)\n\n# 计算前10个斐波那契数\nfor i in range(10):\n    print(f'F({i}) = {fibonacci(i)}')",
                                        "filename": "fibonacci.py",
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                },
                                "create_from_cache": {
                                    "summary": "从缓存创建文件",
                                    "description": "使用缓存中的数据创建文件",
                                    "value": {
                                        "filename": "data.json",
                                        "result_cache_key": "cached_data_123",
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "result": {
                                            "type": "object",
                                            "description": "操作结果, 包含标准输出、标准错误输出、返回值"
                                        },
                                        "message": {
                                            "type": "string",
                                            "description": "操作状态消息"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "description": "错误信息"
                                        },
                                        "detail": {
                                            "type": "string",
                                            "description": "详细错误信息"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/list_files": {
            "post": {
                "summary": "list_files",
                "description": "列出沙箱环境中的所有文件和目录",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "server_url": {
                                        "type": "string",
                                        "description": "可选，沙箱服务器URL，默认使用配置文件中的 SANDBOX_URL",
                                        "default": "http://sandbox-runtime:9101"
                                    },
                                    "session_id": {
                                        "type": "string",
                                        "description": "沙箱会话ID"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "超时时间",
                                        "default": 120
                                    },
                                    "title": {
                                        "type": "string",
                                        "description": "对于当前操作的简单描述，便于用户理解"
                                    }
                                },
                                "required": []
                            },
                            "examples": {
                                "list_all_files": {
                                    "summary": "列出所有文件",
                                    "description": "列出沙箱环境中的所有文件和目录",
                                    "value": {
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "result": {
                                            "type": "object",
                                            "description": "操作结果, 包含标准输出、标准错误输出、返回值"
                                        },
                                        "message": {
                                            "type": "string",
                                            "description": "操作状态消息"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "description": "错误信息"
                                        },
                                        "detail": {
                                            "type": "string",
                                            "description": "详细错误信息"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/get_status": {
            "post": {
                "summary": "get_status",
                "description": "获取沙箱环境的当前状态信息",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "server_url": {
                                        "type": "string",
                                        "description": "可选，沙箱服务器URL，默认使用配置文件中的 SANDBOX_URL",
                                        "default": "http://sandbox-runtime:9101"
                                    },
                                    "session_id": {
                                        "type": "string",
                                        "description": "沙箱会话ID"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "超时时间",
                                        "default": 120
                                    },
                                    "title": {
                                        "type": "string",
                                        "description": "对于当前操作的简单描述，便于用户理解"
                                    }
                                },
                                "required": []
                            },
                            "examples": {
                                "get_sandbox_status": {
                                    "summary": "获取沙箱状态",
                                    "description": "获取沙箱环境的当前状态信息",
                                    "value": {
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "result": {
                                            "type": "object",
                                            "description": "操作结果, 包含标准输出、标准错误输出、返回值"
                                        },
                                        "message": {
                                            "type": "string",
                                            "description": "操作状态消息"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "description": "错误信息"
                                        },
                                        "detail": {
                                            "type": "string",
                                            "description": "详细错误信息"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/close_sandbox": {
            "post": {
                "summary": "close_sandbox",
                "description": "清理沙箱工作区，关闭沙箱连接",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "server_url": {
                                        "type": "string",
                                        "description": "可选，沙箱服务器URL，默认使用配置文件中的 SANDBOX_URL",
                                        "default": "http://sandbox-runtime:9101"
                                    },
                                    "session_id": {
                                        "type": "string",
                                        "description": "沙箱会话ID"
                                    },
                                    "timeout": {
                                        "type": "number",
                                        "description": "超时时间",
                                        "default": 120
                                    },
                                    "title": {
                                        "type": "string",
                                        "description": "对于当前操作的简单描述，便于用户理解"
                                    }
                                },
                                "required": []
                            },
                            "examples": {
                                "close_sandbox": {
                                    "summary": "清理工作区",
                                    "description": "清理沙箱工作区，关闭沙箱连接",
                                    "value": {
                                        "server_url": "http://localhost:8080",
                                        "session_id": "test_session_123"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "result": {
                                            "type": "object",
                                            "description": "操作结果, 包含标准输出、标准错误输出、返回值"
                                        },
                                        "message": {
                                            "type": "string",
                                            "description": "操作状态消息"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "description": "错误信息"
                                        },
                                        "detail": {
                                            "type": "string",
                                            "description": "详细错误信息"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/download_from_efast": {
            "post": {
                "summary": "download_from_efast",
                "description": "从文档库(EFAST)下载文件到沙箱环境，支持批量下载多个文件。需要提供文件参数列表，格式为[{'id': '...', 'type': 'doc', 'name': '...', 'details': {'docid': 'gns://...', 'size': ...}}]",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "server_url": {
                                        "type": "string",
                                        "description": "可选，沙箱服务器URL，默认使用配置文件中的 SANDBOX_URL",
                                        "default": "http://sandbox-runtime:9101"
                                    },
                                    "session_id": {
                                        "type": "string",
                                        "description": "沙箱会话ID"
                                    },
                                    "timeout": {
                                        "type": "integer",
                                        "description": "超时时间(秒)，可选，默认300秒",
                                        "default": 300
                                    },
                                    "title": {
                                        "type": "string",
                                        "description": "对于当前操作的简单描述，便于用户理解"
                                    },
                                    "file_params": {
                                        "type": "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "id": {
                                                    "type": "string",
                                                    "description": "文档ID"
                                                },
                                                "name": {
                                                    "type": "string",
                                                    "description": "文档名称"
                                                },
                                                "details": {
                                                    "type": "object",
                                                    "properties": {
                                                        "docid": {
                                                            "type": "string",
                                                            "description": "完整的文档ID"
                                                        }
                                                    },
                                                    "required": [
                                                        "docid"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "details"
                                            ]
                                        },
                                        "description": "下载文件参数列表"
                                    },
                                    "save_path": {
                                        "type": "string",
                                        "description": "保存路径，可选，默认保存到会话目录"
                                    },
                                    "efast_url": {
                                        "type": "string",
                                        "description": "EFAST地址，可选，默认使用默认URL"
                                    },
                                    "token": {
                                        "type": "string",
                                        "description": "认证令牌"
                                    }
                                },
                                "required": [
                                    "file_params"
                                ]
                            },
                            "examples": {
                                "single_file": {
                                    "summary": "下载单个文件",
                                    "description": "从文档库(EFAST)下载单个文件",
                                    "value": {
                                        "file_params": [
                                            {
                                                "id": "5CB5AA515EBD4CB785918D43982FCE42",
                                                "type": "doc",
                                                "name": "新能源汽车产业分析 (10).docx",
                                                "details": {
                                                    "docid": "gns://00328E97423F42AC9DEE87B4F4B4631E/83D893844A0B4A34A64DFFB343BEF416/5CB5AA515EBD4CB785918D43982FCE42",
                                                    "size": 15635
                                                }
                                            }
                                        ],
                                        "save_path": "",
                                        "efast_url": "https://efast.example.com",
                                        "timeout": 300,
                                        "token": "1234567890",
                                        "server_url": "",
                                        "session_id": "test_session_123"
                                    }
                                },
                                "multiple_files": {
                                    "summary": "批量下载文件",
                                    "description": "从文档库(EFAST)批量下载多个文件",
                                    "value": {
                                        "file_params": [
                                            {
                                                "id": "5CB5AA515EBD4CB785918D43982FCE42",
                                                "type": "doc",
                                                "name": "新能源汽车产业分析 (10).docx",
                                                "details": {
                                                    "docid": "gns://00328E97423F42AC9DEE87B4F4B4631E/83D893844A0B4A34A64DFFB343BEF416/5CB5AA515EBD4CB785918D43982FCE42",
                                                    "size": 15635
                                                }
                                            },
                                            {
                                                "id": "6CB5AA515EBD4CB785918D43982FCE43",
                                                "type": "doc",
                                                "name": "市场分析报告.pdf",
                                                "details": {
                                                    "docid": "gns://00328E97423F42AC9DEE87B4F4B4631E/83D893844A0B4A34A64DFFB343BEF416/6CB5AA515EBD4CB785918D43982FCE43",
                                                    "size": 24567
                                                }
                                            }
                                        ],
                                        "save_path": "",
                                        "timeout": 600,
                                        "token": "1234567890",
                                        "server_url": "",
                                        "session_id": "test_session_123"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "result": {
                                            "type": "object",
                                            "description": "操作结果, 包含标准输出、标准错误输出、返回值"
                                        },
                                        "message": {
                                            "type": "string",
                                            "description": "操作状态消息"
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "description": "错误信息"
                                        },
                                        "detail": {
                                            "type": "string",
                                            "description": "详细错误信息"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/knowledge_rerank": {
            "post": {
                "summary": "knowledge_rerank",
                "description": "概念重排序工具，根据查询意图对概念列表进行重排序",
                "parameters": [
                    {
                        "name": "stream",
                        "in": "query",
                        "description": "是否流式返回",
                        "schema": {
                            "type": "boolean",
                            "default": false
                        }
                    },
                    {
                        "name": "mode",
                        "in": "query",
                        "description": "请求模式",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "http",
                                "sse"
                            ],
                            "default": "http"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "query_understanding": {
                                        "type": "object",
                                        "description": "查询理解结果",
                                        "properties": {
                                            "origin_query": {
                                                "type": "string",
                                                "description": "原始查询文本"
                                            },
                                            "processed_query": {
                                                "type": "string",
                                                "description": "处理后的查询文本"
                                            },
                                            "intent": {
                                                "type": "array",
                                                "description": "意图列表",
                                                "items": {
                                                    "type": "object",
                                                    "properties": {
                                                        "type": {
                                                            "type": "string"
                                                        },
                                                        "description": {
                                                            "type": "string"
                                                        },
                                                        "confidence": {
                                                            "type": "number"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "required": [
                                            "origin_query"
                                        ]
                                    },
                                    "concepts": {
                                        "type": "array",
                                        "description": "需要重排序的概念列表",
                                        "items": {
                                            "type": "object"
                                        }
                                    },
                                    "action": {
                                        "type": "string",
                                        "description": "重排序方法",
                                        "enum": [
                                            "llm",
                                            "vector"
                                        ],
                                        "default": "llm"
                                    },
                                    "batch_size": {
                                        "type": "integer",
                                        "description": "批处理大小",
                                        "default": 128
                                    }
                                },
                                "required": [
                                    "query_understanding",
                                    "concepts"
                                ]
                            },
                            "example": {
                                "query_understanding": {
                                    "origin_query": "分析销售数据中的趋势",
                                    "processed_query": "分析销售数据中的趋势",
                                    "intent": [
                                        {
                                            "type": "analysis",
                                            "description": "数据分析意图",
                                            "confidence": 0.9
                                        }
                                    ]
                                },
                                "concepts": [
                                    {
                                        "id": "concept_1",
                                        "name": "销售额",
                                        "description": "产品的销售金额",
                                        "type": "metric",
                                        "properties": {}
                                    }
                                ],
                                "action": "llm",
                                "batch_size": 128
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "description": "重排序后的概念列表",
                                    "items": {
                                        "type": "object",
                                        "properties": {
                                            "id": {
                                                "type": "string"
                                            },
                                            "name": {
                                                "type": "string"
                                            },
                                            "description": {
                                                "type": "string"
                                            },
                                            "type": {
                                                "type": "string"
                                            },
                                            "properties": {
                                                "type": "object"
                                            },
                                            "rerank_score": {
                                                "type": "number"
                                            }
                                        }
                                    }
                                },
                                "example": [
                                    {
                                        "id": "concept_1",
                                        "name": "销售额",
                                        "description": "产品的销售金额",
                                        "type": "metric",
                                        "properties": {},
                                        "rerank_score": 0.95
                                    }
                                ]
                            }
                        }
                    }
                }
            }
        },
        "/tools/kn_search": {
            "post": {
                "summary": "kn_search",
                "description": "基于知识网络的智能检索工具，支持传入完整的问题或一个或多个关键词，能够检索问题或关键词的属性信息和上下文信息。",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "query": {
                                        "type": "string",
                                        "description": "用户查询问题或关键词，多个关键词之间用空格隔开"
                                    },
                                    "enable_rerank": {
                                        "type": "boolean",
                                        "description": "是否启用向量重排序。False时使用降级策略（粗召回分数、关键词匹配等）。适用于没有重排序模型的环境。",
                                        "default": true
                                    },
                                    "kn_ids": {
                                        "type": "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "knowledge_network_id": {
                                                    "type": "string",
                                                    "description": "知识网络ID"
                                                }
                                            },
                                            "required": [
                                                "knowledge_network_id"
                                            ]
                                        },
                                        "description": "指定的知识网络配置列表，必须传递，每个配置包含knowledge_network_id字段"
                                    },
                                    "session_id": {
                                        "type": "string",
                                        "description": "会话ID，用于维护多轮对话存储的历史召回记录",
                                        "nullable": true
                                    },
                                    "additional_context": {
                                        "type": "string",
                                        "description": "额外的上下文信息，用于二次检索时提供更精确的检索信息",
                                        "nullable": true
                                    },
                                    "retrieval_config": {
                                        "type": "object",
                                        "description": "召回配置参数，用于控制不同类型的召回场景（概念召回、语义实例召回、属性过滤）。如果不提供，将使用系统默认配置。",
                                        "nullable": true,
                                        "properties": {
                                            "concept_retrieval": {
                                                "type": "object",
                                                "description": "概念召回/概念流程配置参数（原最外层参数已收敛到此处）",
                                                "nullable": true,
                                                "properties": {
                                                    "top_k": {
                                                        "type": "integer",
                                                        "description": "概念召回返回最相关关系类型数量（对象类型会随关系类型自动过滤）。",
                                                        "minimum": 1,
                                                        "default": 10
                                                    },
                                                    "skip_llm": {
                                                        "type": "boolean",
                                                        "description": "是否跳过LLM筛选相关关系类型，直接使用前top_k个关系类型（高召回/低成本）。",
                                                        "default": true
                                                    },
                                                    "return_union": {
                                                        "type": "boolean",
                                                        "description": "概念召回多轮检索时是否返回并集。True返回所有轮次并集；False仅返回当前轮次增量（默认False）。",
                                                        "default": false
                                                    },
                                                    "include_sample_data": {
                                                        "type": "boolean",
                                                        "description": "是否获取对象类型的样例数据。True会为每个召回对象类型获取一条样例数据。",
                                                        "default": false
                                                    },
                                                    "schema_brief": {
                                                        "type": "boolean",
                                                        "description": "概念召回时是否返回精简schema。True仅返回必要字段（概念ID/名称/关系source&target），不返回大字段。",
                                                        "default": true
                                                    },
                                                    "enable_coarse_recall": {
                                                        "type": "boolean",
                                                        "description": "是否在概念召回前启用对象/关系粗召回，用于在大规模知识网络中先裁剪候选集合。",
                                                        "default": true
                                                    },
                                                    "coarse_object_limit": {
                                                        "type": "integer",
                                                        "description": "对象类型粗召回的最大返回数量，用于限制候选对象规模。",
                                                        "minimum": 1,
                                                        "default": 2000
                                                    },
                                                    "coarse_relation_limit": {
                                                        "type": "integer",
                                                        "description": "关系类型粗召回的最大返回数量，用于限制候选关系规模。",
                                                        "minimum": 1,
                                                        "default": 300
                                                    },
                                                    "coarse_min_relation_count": {
                                                        "type": "integer",
                                                        "description": "仅当知识网络内关系类型总数达到该阈值时才启用粗召回；小规模网络直接走精排流程。",
                                                        "minimum": 1,
                                                        "default": 5000
                                                    },
                                                    "enable_property_brief": {
                                                        "type": "boolean",
                                                        "description": "在 schema_brief=True 时，是否对返回的对象属性做相关性裁剪（每对象TopK，全局TopK）。",
                                                        "default": true
                                                    },
                                                    "per_object_property_top_k": {
                                                        "type": "integer",
                                                        "description": "属性裁剪时，每个对象类型最多保留的属性数量。生产环境建议值：8-10，适配表多、字段多的场景。",
                                                        "minimum": 1,
                                                        "default": 8
                                                    },
                                                    "global_property_top_k": {
                                                        "type": "integer",
                                                        "description": "属性裁剪时，全局最多保留的属性总数量。生产环境建议值：30-50，确保在多对象类型场景下保留足够的全局属性信息。",
                                                        "minimum": 1,
                                                        "default": 30
                                                    }
                                                }
                                            },
                                            "semantic_instance_retrieval": {
                                                "type": "object",
                                                "description": "语义实例召回配置参数",
                                                "nullable": true,
                                                "properties": {
                                                    "initial_candidate_count": {
                                                        "type": "integer",
                                                        "description": "语义实例召回的初始召回数量上限（重排序前的候选数量）。建议值：一般设置为per_type_instance_limit的3-5倍。",
                                                        "minimum": 1,
                                                        "default": 50
                                                    },
                                                    "per_type_instance_limit": {
                                                        "type": "integer",
                                                        "description": "每个对象类型最终返回的实例数量上限（重排序后的数量）。每个对象类型单独控制。",
                                                        "minimum": 1,
                                                        "default": 5
                                                    },
                                                    "max_semantic_sub_conditions": {
                                                        "type": "integer",
                                                        "description": "语义实例召回构造查询条件时 sub_conditions 的最大数量上限（用于适配后端限制与控成本）。默认10。",
                                                        "minimum": 1,
                                                        "default": 10
                                                    },
                                                    "semantic_field_keep_ratio": {
                                                        "type": "number",
                                                        "description": "语义字段筛选保留比例（按重排序分数Top-K保留）。例如0.2表示保留前20%的字段。",
                                                        "minimum": 0.01,
                                                        "maximum": 1.0,
                                                        "default": 0.2
                                                    },
                                                    "semantic_field_keep_min": {
                                                        "type": "integer",
                                                        "description": "语义字段筛选最少保留字段数（字段较少时兜底）。",
                                                        "minimum": 1,
                                                        "default": 5
                                                    },
                                                    "semantic_field_keep_max": {
                                                        "type": "integer",
                                                        "description": "语义字段筛选最多保留字段数（字段很多时强力限流）。",
                                                        "minimum": 1,
                                                        "default": 15
                                                    },
                                                    "semantic_field_rerank_batch_size": {
                                                        "type": "integer",
                                                        "description": "字段语义打分（rerank）时的批处理大小，字段数很大时会分批调用重排序服务。",
                                                        "minimum": 1,
                                                        "default": 128
                                                    },
                                                    "min_direct_relevance": {
                                                        "type": "number",
                                                        "description": "直接相关性最低阈值（0-1之间）。过滤掉直接相关性分数低于此阈值的实例。",
                                                        "minimum": 0.0,
                                                        "maximum": 1.0,
                                                        "default": 0.3
                                                    },
                                                    "enable_global_final_score_ratio_filter": {
                                                        "type": "boolean",
                                                        "description": "是否启用全局 final_score 相对阈值过滤。启用后仅保留 final_score >= max_final_score * global_final_score_ratio 的实例。",
                                                        "default": true
                                                    },
                                                    "global_final_score_ratio": {
                                                        "type": "number",
                                                        "description": "全局 final_score 相对阈值比例 r（0~1）。当 enable_global_final_score_ratio_filter=True 时，仅保留 final_score >= max_final_score * r 的实例。",
                                                        "minimum": 0.0,
                                                        "maximum": 1.0,
                                                        "default": 0.25
                                                    },
                                                    "exact_name_match_score": {
                                                        "type": "number",
                                                        "description": "多关键词检索场景下的实例名完全相等保底分（0~1）。当 query 被拆分为多个关键词时，只要任一关键词与 instance_name 完全相等，则会将该实例的基础语义分提升到该值，避免被其他关键词（如症状词）稀释后丢失。",
                                                        "minimum": 0.0,
                                                        "maximum": 1.0,
                                                        "default": 0.85
                                                    }
                                                }
                                            },
                                            "property_filter": {
                                                "type": "object",
                                                "description": "实例属性过滤配置（通用，适用于所有实例召回）",
                                                "nullable": true,
                                                "properties": {
                                                    "max_properties_per_instance": {
                                                        "type": "integer",
                                                        "description": "每个实例最多返回的属性字段数量。用于过滤实例属性，减少返回结果大小。",
                                                        "minimum": 1,
                                                        "default": 20
                                                    },
                                                    "max_property_value_length": {
                                                        "type": "integer",
                                                        "description": "属性值的最大长度（字符数），超过此长度的字段值会被过滤。",
                                                        "minimum": 1,
                                                        "default": 500
                                                    },
                                                    "enable_property_filter": {
                                                        "type": "boolean",
                                                        "description": "是否启用实例属性过滤。如果为False，返回所有属性字段。",
                                                        "default": true
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    "only_schema": {
                                        "type": "boolean",
                                        "description": "是否只召回概念（schema），不召回语义实例。如果为True，则只返回object_types、relation_types和action_types，不返回nodes。默认为False。",
                                        "default": false
                                    }
                                },
                                "required": [
                                    "query",
                                    "kn_ids"
                                ]
                            },
                            "examples": {
                                "basic_query": {
                                    "summary": "基本查询示例",
                                    "description": "一个基本的知识网络检索查询示例",
                                    "value": {
                                        "query": "查询化工企业使用的催化剂信息",
                                        "kn_ids": [
                                            {
                                                "knowledge_network_id": "129"
                                            }
                                        ],
                                        "retrieval_config": {
                                            "concept_retrieval": {
                                                "top_k": 10
                                            }
                                        }
                                    }
                                },
                                "query_with_context": {
                                    "summary": "带上下文的查询示例",
                                    "description": "一个带有额外上下文信息的查询示例，用于二次检索",
                                    "value": {
                                        "query": "查询化工企业使用的催化剂信息",
                                        "kn_ids": [
                                            {
                                                "knowledge_network_id": "129"
                                            }
                                        ],
                                        "additional_context": "用户之前查询了关于化工企业的信息，现在想了解相关的催化剂",
                                        "retrieval_config": {
                                            "concept_retrieval": {
                                                "top_k": 10
                                            }
                                        }
                                    }
                                },
                                "query_with_kn_ids": {
                                    "summary": "指定知识网络ID的查询示例",
                                    "description": "一个指定了特定知识网络ID的查询示例",
                                    "value": {
                                        "query": "查询化工企业使用的催化剂信息",
                                        "kn_ids": [
                                            {
                                                "knowledge_network_id": "129"
                                            }
                                        ],
                                        "retrieval_config": {
                                            "concept_retrieval": {
                                                "top_k": 10
                                            }
                                        }
                                    }
                                },
                                "query_with_session": {
                                    "summary": "多轮对话查询示例",
                                    "description": "一个带有会话ID的查询示例，用于多轮对话场景",
                                    "value": {
                                        "query": "查询化工企业使用的催化剂信息",
                                        "kn_ids": [
                                            {
                                                "knowledge_network_id": "129"
                                            }
                                        ],
                                        "session_id": "user_session_123",
                                        "additional_context": "用户之前查询了关于化工企业的信息，现在想了解相关的催化剂",
                                        "retrieval_config": {
                                            "concept_retrieval": {
                                                "top_k": 10,
                                                "return_union": false
                                            }
                                        }
                                    }
                                },
                                "query_with_semantic_instance": {
                                    "summary": "语义实例召回查询示例",
                                    "description": "一个使用语义实例召回的查询示例",
                                    "value": {
                                        "query": "查询化工企业使用的催化剂信息",
                                        "kn_ids": [
                                            {
                                                "knowledge_network_id": "129"
                                            }
                                        ],
                                        "session_id": "user_session_123",
                                        "retrieval_config": {
                                            "concept_retrieval": {
                                                "top_k": 10
                                            },
                                            "semantic_instance_retrieval": {
                                                "initial_candidate_count": 50,
                                                "per_type_instance_limit": 10
                                            }
                                        }
                                    }
                                },
                                "query_with_property_brief": {
                                    "summary": "属性裁剪配置查询示例",
                                    "description": "一个展示属性裁剪配置的查询示例，适用于生产环境表多、字段多的场景",
                                    "value": {
                                        "query": "查询化工企业使用的催化剂信息",
                                        "kn_ids": [
                                            {
                                                "knowledge_network_id": "129"
                                            }
                                        ],
                                        "retrieval_config": {
                                            "concept_retrieval": {
                                                "top_k": 10,
                                                "schema_brief": true,
                                                "enable_property_brief": true,
                                                "per_object_property_top_k": 8,
                                                "global_property_top_k": 30,
                                                "enable_coarse_recall": true,
                                                "coarse_object_limit": 2000,
                                                "coarse_relation_limit": 300
                                            },
                                            "semantic_instance_retrieval": {
                                                "initial_candidate_count": 50,
                                                "per_type_instance_limit": 10
                                            },
                                            "property_filter": {
                                                "max_properties_per_instance": 20,
                                                "enable_property_filter": true
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "parameters": [
                    {
                        "name": "x-account-id",
                        "in": "header",
                        "required": true,
                        "schema": {
                            "type": "string"
                        },
                        "description": "账户ID，用于内部服务调用时传递账户信息（必需）"
                    },
                    {
                        "name": "x-account-type",
                        "in": "header",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "user",
                                "app",
                                "anonymous"
                            ]
                        },
                        "description": "账户类型：user(用户), app(应用), anonymous(匿名)（必需）"
                    },
                    {
                        "name": "Content-Type",
                        "in": "header",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "default": "application/json"
                        },
                        "description": "内容类型"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "description": "检索结果，返回object_types/relation_types/action_types，并返回语义实例nodes/message。多轮时由concept_retrieval.return_union控制 nodes 的并集/增量。",
                                    "properties": {
                                        "object_types": {
                                            "type": "array",
                                            "description": "对象类型列表（概念召回时返回）。当schema_brief=True时，仅包含：concept_id, concept_name, comment, data_properties（仅name和display_name）, logic_properties（仅name和display_name）, sample_data（当include_sample_data=True时）。当schema_brief=False时，包含完整字段（包括primary_keys, display_key, sample_data等）",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "concept_type": {
                                                        "type": "string",
                                                        "description": "概念类型: object_type",
                                                        "nullable": true
                                                    },
                                                    "concept_id": {
                                                        "type": "string",
                                                        "description": "概念ID"
                                                    },
                                                    "concept_name": {
                                                        "type": "string",
                                                        "description": "概念名称"
                                                    },
                                                    "comment": {
                                                        "type": "string",
                                                        "description": "概念描述",
                                                        "nullable": true
                                                    },
                                                    "data_properties": {
                                                        "type": "array",
                                                        "description": "对象属性列表。精简模式下仅包含name和display_name字段（数量不截断）",
                                                        "items": {
                                                            "type": "object",
                                                            "description": "对象属性",
                                                            "properties": {
                                                                "name": {
                                                                    "type": "string",
                                                                    "description": "属性名称",
                                                                    "nullable": true
                                                                },
                                                                "display_name": {
                                                                    "type": "string",
                                                                    "description": "属性显示名称",
                                                                    "nullable": true
                                                                },
                                                                "comment": {
                                                                    "type": "string",
                                                                    "description": "属性描述（非精简模式）",
                                                                    "nullable": true
                                                                }
                                                            }
                                                        },
                                                        "nullable": true
                                                    },
                                                    "logic_properties": {
                                                        "type": "array",
                                                        "description": "逻辑属性列表（指标等）。精简模式下仅包含name和display_name字段（数量不截断）",
                                                        "items": {
                                                            "type": "object",
                                                            "description": "逻辑属性",
                                                            "properties": {
                                                                "name": {
                                                                    "type": "string",
                                                                    "description": "属性名称",
                                                                    "nullable": true
                                                                },
                                                                "display_name": {
                                                                    "type": "string",
                                                                    "description": "属性显示名称",
                                                                    "nullable": true
                                                                }
                                                            }
                                                        },
                                                        "nullable": true
                                                    },
                                                    "primary_keys": {
                                                        "type": "array",
                                                        "description": "主键字段列表（支持多个主键）。仅当schema_brief=False时返回",
                                                        "items": {
                                                            "type": "string"
                                                        },
                                                        "nullable": true
                                                    },
                                                    "display_key": {
                                                        "type": "string",
                                                        "description": "显示字段名（用于获取instance_name）。仅当schema_brief=False时返回",
                                                        "nullable": true
                                                    },
                                                    "sample_data": {
                                                        "type": "object",
                                                        "description": "样例数据（当include_sample_data=True时返回，无论schema_brief是否为True）",
                                                        "nullable": true
                                                    }
                                                },
                                                "required": [
                                                    "concept_id",
                                                    "concept_name"
                                                ]
                                            }
                                        },
                                        "relation_types": {
                                            "type": "array",
                                            "description": "关系类型列表（概念召回时返回）。精简模式和完整模式均包含：concept_id, concept_name, source_object_type_id, target_object_type_id",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "concept_type": {
                                                        "type": "string",
                                                        "description": "概念类型: relation_type",
                                                        "nullable": true
                                                    },
                                                    "concept_id": {
                                                        "type": "string",
                                                        "description": "概念ID"
                                                    },
                                                    "concept_name": {
                                                        "type": "string",
                                                        "description": "概念名称"
                                                    },
                                                    "source_object_type_id": {
                                                        "type": "string",
                                                        "description": "源对象类型ID"
                                                    },
                                                    "target_object_type_id": {
                                                        "type": "string",
                                                        "description": "目标对象类型ID"
                                                    }
                                                },
                                                "required": [
                                                    "concept_id",
                                                    "concept_name",
                                                    "source_object_type_id",
                                                    "target_object_type_id"
                                                ]
                                            }
                                        },
                                        "action_types": {
                                            "type": "array",
                                            "description": "操作类型列表（概念召回时返回）。当schema_brief=True时，每个action_type仅包含以下字段：id, name, action_type, object_type_id, object_type_name, comment, tags, kn_id",
                                            "nullable": true,
                                            "items": {
                                                "type": "object",
                                                "description": "操作类型信息。精简模式（schema_brief=True）下仅包含：id, name, action_type, object_type_id, object_type_name, comment, tags, kn_id",
                                                "properties": {
                                                    "id": {
                                                        "type": "string",
                                                        "description": "操作类型ID"
                                                    },
                                                    "name": {
                                                        "type": "string",
                                                        "description": "操作类型名称"
                                                    },
                                                    "action_type": {
                                                        "type": "string",
                                                        "description": "操作类型（如：add, modify等）"
                                                    },
                                                    "object_type_id": {
                                                        "type": "string",
                                                        "description": "对象类型ID"
                                                    },
                                                    "object_type_name": {
                                                        "type": "string",
                                                        "description": "对象类型名称"
                                                    },
                                                    "comment": {
                                                        "type": "string",
                                                        "description": "注释说明",
                                                        "nullable": true
                                                    },
                                                    "tags": {
                                                        "type": "array",
                                                        "description": "标签列表",
                                                        "items": {
                                                            "type": "string"
                                                        },
                                                        "nullable": true
                                                    },
                                                    "kn_id": {
                                                        "type": "string",
                                                        "description": "知识网络ID"
                                                    }
                                                }
                                            }
                                        },
                                        "nodes": {
                                            "type": "array",
                                            "description": "语义实例召回结果（当不提供conditions且召回到实例时返回），与条件召回节点风格对齐的扁平列表",
                                            "nullable": true,
                                            "items": {
                                                "type": "object",
                                                "description": "节点数据，至少包含 object_type_id、<object_type_id>_name、unique_identities",
                                                "properties": {
                                                    "object_type_id": {
                                                        "type": "string"
                                                    },
                                                    "unique_identities": {
                                                        "type": "object"
                                                    }
                                                }
                                            }
                                        },
                                        "message": {
                                            "type": "string",
                                            "description": "提示信息（例如未召回到实例数据时返回原因说明）",
                                            "nullable": true
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/kn_path_search": {
            "post": {
                "summary": "kn_path_search",
                "description": "根据关系路径检索对象，并根据properties字段过滤结果。返回结构为 meta + table（类SQL：columns + rows），面向大模型问答场景做了精简。注意：该返回格式为新版本，不兼容旧版 results 平铺结构。",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "kn_id": {
                                        "type": "string",
                                        "description": "知识网络ID"
                                    },
                                    "relation_type_paths": {
                                        "type": "array",
                                        "description": "关系类型路径列表",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "object_types": {
                                                    "type": "array",
                                                    "description": "对象类型列表",
                                                    "items": {
                                                        "type": "object",
                                                        "properties": {
                                                            "id": {
                                                                "type": "string",
                                                                "description": "对象类型ID"
                                                            },
                                                            "condition": {
                                                                "type": "object",
                                                                "description": "查询条件，统一使用sub_conditions结构。顶层只有operation和sub_conditions两个字段。单个条件：{operation: 'and', sub_conditions: [{field: 'name', operation: '==', value: '张三', value_from: 'const'}]}。多个条件：{operation: 'and', sub_conditions: [{field: 'p_gender', operation: '==', value: 'male', value_from: 'const'}, {field: 'age', operation: '>', value: 30, value_from: 'const'}]}",
                                                                "nullable": true,
                                                                "properties": {
                                                                    "operation": {
                                                                        "type": "string",
                                                                        "description": "逻辑操作符，如 'and', 'or'",
                                                                        "enum": [
                                                                            "and",
                                                                            "or"
                                                                        ]
                                                                    },
                                                                    "sub_conditions": {
                                                                        "type": "array",
                                                                        "description": "子条件列表，不支持嵌套。每个子条件是单个条件，包含 field, operation（比较操作符）, value, value_from",
                                                                        "items": {
                                                                            "type": "object",
                                                                            "properties": {
                                                                                "field": {
                                                                                    "type": "string",
                                                                                    "description": "字段名"
                                                                                },
                                                                                "operation": {
                                                                                    "type": "string",
                                                                                    "description": "比较操作符，如 '==', '>', '<', '>=', '<=' 等"
                                                                                },
                                                                                "value": {
                                                                                    "description": "字段值"
                                                                                },
                                                                                "value_from": {
                                                                                    "type": "string",
                                                                                    "description": "值来源，如 'const'",
                                                                                    "default": "const"
                                                                                }
                                                                            },
                                                                            "required": [
                                                                                "field",
                                                                                "operation",
                                                                                "value"
                                                                            ]
                                                                        }
                                                                    }
                                                                },
                                                                "required": [
                                                                    "operation",
                                                                    "sub_conditions"
                                                                ]
                                                            },
                                                            "limit": {
                                                                "type": "integer",
                                                                "description": "返回结果数量限制",
                                                                "default": 10,
                                                                "nullable": true
                                                            },
                                                            "properties": {
                                                                "type": "array",
                                                                "description": "需要返回的属性列表，只有指定了properties的对象才会在结果中保留",
                                                                "items": {
                                                                    "type": "string"
                                                                },
                                                                "nullable": true
                                                            }
                                                        },
                                                        "required": [
                                                            "id"
                                                        ]
                                                    }
                                                },
                                                "relation_types": {
                                                    "type": "array",
                                                    "description": "关系类型列表",
                                                    "items": {
                                                        "type": "object",
                                                        "properties": {
                                                            "relation_type_id": {
                                                                "type": "string",
                                                                "description": "关系类型ID"
                                                            },
                                                            "source_object_type_id": {
                                                                "type": "string",
                                                                "description": "源对象类型ID"
                                                            },
                                                            "target_object_type_id": {
                                                                "type": "string",
                                                                "description": "目标对象类型ID"
                                                            }
                                                        },
                                                        "required": [
                                                            "relation_type_id",
                                                            "source_object_type_id",
                                                            "target_object_type_id"
                                                        ]
                                                    }
                                                },
                                                "limit": {
                                                    "type": "integer",
                                                    "description": "路径数量限制",
                                                    "default": 10,
                                                    "nullable": true
                                                }
                                            },
                                            "required": [
                                                "object_types",
                                                "relation_types"
                                            ]
                                        }
                                    }
                                },
                                "required": [
                                    "kn_id",
                                    "relation_type_paths"
                                ]
                            },
                            "examples": {
                                "basic_query": {
                                    "summary": "基本查询示例",
                                    "description": "查询上气道梗阻的症状，只返回symptom对象的symptom_name属性",
                                    "value": {
                                        "kn_id": "kn_medical",
                                        "relation_type_paths": [
                                            {
                                                "object_types": [
                                                    {
                                                        "id": "disease",
                                                        "condition": {
                                                            "operation": "and",
                                                            "sub_conditions": [
                                                                {
                                                                    "field": "disease_name",
                                                                    "operation": "==",
                                                                    "value": "上气道梗阻",
                                                                    "value_from": "const"
                                                                }
                                                            ]
                                                        },
                                                        "limit": 10,
                                                        "properties": [
                                                            "disease_name"
                                                        ]
                                                    },
                                                    {
                                                        "id": "symptom",
                                                        "limit": 10,
                                                        "properties": [
                                                            "symptom_name"
                                                        ]
                                                    }
                                                ],
                                                "relation_types": [
                                                    {
                                                        "relation_type_id": "has_symptom",
                                                        "source_object_type_id": "disease",
                                                        "target_object_type_id": "symptom"
                                                    }
                                                ],
                                                "limit": 10
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                },
                "parameters": [
                    {
                        "name": "x-account-id",
                        "in": "header",
                        "required": false,
                        "schema": {
                            "type": "string"
                        },
                        "description": "账户ID，用于内部服务调用时传递账户信息"
                    },
                    {
                        "name": "x-account-type",
                        "in": "header",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "user",
                                "app",
                                "anonymous"
                            ],
                            "default": "user"
                        },
                        "description": "账户类型：user(用户), app(应用), anonymous(匿名)"
                    },
                    {
                        "name": "Content-Type",
                        "in": "header",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "default": "application/json"
                        },
                        "description": "内容类型"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful operation",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "description": "检索结果（meta + table）",
                                    "properties": {
                                        "meta": {
                                            "type": "object",
                                            "description": "请求与执行元信息（包含默认limit是否生效、最终生效limit、行数等）"
                                        },
                                        "table": {
                                            "type": "object",
                                            "description": "全局结果表（类SQL）",
                                            "properties": {
                                                "columns": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string"
                                                    }
                                                },
                                                "rows": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "array",
                                                        "items": {}
                                                    }
                                                }
                                            },
                                            "required": [
                                                "columns",
                                                "rows"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/tools/cypher_query": {
            "post": {
                "summary": "cypher_query",
                "description": "使用类Cypher语法模板查询知识网络（注意：不是标准Neo4j Cypher，是定制语法）。\n支持：\n1. 单个对象检索：MATCH (a:ObjectType) WHERE ... RETURN ...\n2. 关系路径查询（2-10节点）：MATCH (a:TypeA)-[r1:RelType1]->(b:TypeB)-[r2:RelType2]->(c:TypeC)... WHERE ... RETURN ...\n\n特殊支持：KNN（向量搜索）、MATCH（全文搜索）等扩展运算符，使用方式与标准Cypher不同（KNN/MATCH后面不需要等号，直接跟值）。",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "kn_id": {
                                        "type": "string",
                                        "description": "知识网络ID"
                                    },
                                    "cypher": {
                                        "type": "string",
                                        "description": "**重要：这是类Cypher语法模板，不是标准Neo4j Cypher！**\n\n本工具支持类Cypher语法查询知识网络，语法结构与标准Cypher类似，但有以下重要差异：\n1. 仅支持特定的查询模板（见下方），不是完整的Cypher语法\n2. 支持扩展运算符：KNN（向量搜索）、MATCH（全文搜索）\n3. 运算符使用方式与标准Cypher不同（特别是KNN、MATCH等）\n\n支持的查询模式：\n\n**1. 单个对象检索**\n单个对象检索：MATCH (a:ObjectType) WHERE a.field == 'value' RETURN a.field1, a.field2 [LIMIT n]\n\n示例：\n```cypher\nMATCH (a:disease) WHERE a.disease_name == '发烧' RETURN a.disease_name, a.age LIMIT 10\n```\n\n**2. 关系路径查询（2-10节点）**\n关系路径查询：MATCH (a:TypeA)-[r1:RelType1]->(b:TypeB)-[r2:RelType2]->(c:TypeC)... WHERE ... RETURN ... [LIMIT n] (支持2-10节点)\n\n示例：\n```cypher\nMATCH (a:disease)-[r:has_symptom]->(b:symptom) WHERE a.disease_name == '上气道梗阻' RETURN a.disease_name, b.symptom_name\n```\n\n```cypher\nMATCH (a:person)-[r1:belongs_to]->(b:school)-[r2:has_major]->(c:major) WHERE a.name == '张三' RETURN a.name, b.school_name, c.major_name\n```\n\n```cypher\nMATCH (a:person)-[r1:belongs_to]->(b:school)-[r2:has_major]->(c:major)-[r3:taught_by]->(d:teacher) WHERE a.name == '张三' RETURN a.name, b.school_name, c.major_name, d.teacher_name\n```\n\n**支持的运算符（重要：与标准Cypher不同）**：\n\n**1. 标准比较运算符（SQL风格）**：\n- 格式：`a.field == 'value'` 或 `a.field != 'value'`\n- 支持：==, !=, >, <, >=, <=, LIKE\n- 示例：`WHERE a.disease_name == '发烧'` 或 `WHERE a.age > 30`\n\n**2. 扩展运算符（OpenSearch风格，本工具独有）**：\n- **KNN（向量相似度搜索）**：格式 `a.field KNN 'query_text'`（注意：不需要等号！）\n  - 示例：`WHERE a.disease_name KNN '发烧'`\n  - 用途：基于向量相似度进行语义搜索，默认k=50\n- **MATCH（全文搜索）**：格式 `a.field MATCH 'query_text'`（注意：不需要等号！）\n  - 示例：`WHERE a.symptom_name MATCH '咳嗽'`\n  - 用途：基于OpenSearch的全文搜索\n\n**语法规则说明**：\n- MATCH子句必需，用于指定查询的节点和关系模式\n- WHERE子句可选，用于过滤条件\n- RETURN子句必需，用于指定返回的字段（格式：a.field1, b.field2）\n- LIMIT子句可选，用于限制返回结果数量（如：LIMIT 10），未指定时使用默认值\n- 关系路径必须是单向的（箭头方向一致，如：->）\n- 节点变量名可自定义（如：a, b, c 或 person, school, major）\n- 关系变量名可自定义（如：r, r1, r2 或 belongs_to, has_major）\n\n**关键差异提醒（与标准Cypher不同）**：\n- KNN、MATCH运算符后面**不需要等号**，直接跟值：`a.field KNN 'value'`\n- 标准运算符需要等号：`a.field == 'value'`\n- WHERE子句中可以使用混合运算符，如：`WHERE a.name == '发烧' AND a.description KNN '症状'`\n- 本工具不支持标准Cypher的复杂语法（如OPTIONAL MATCH、UNWIND、聚合函数等）"
                                    }
                                },
                                "required": [
                                    "kn_id",
                                    "cypher"
                                ]
                            },
                            "examples": {
                                "single_object": {
                                    "summary": "单个对象检索：MATCH (a:ObjectType) WHERE a.field == 'value' RETURN a.field1, a.field2 [LIMIT n]",
                                    "description": "单个对象检索：MATCH (a:ObjectType) WHERE a.field == 'value' RETURN a.field1, a.field2 [LIMIT n]",
                                    "value": {
                                        "kn_id": "kn_medical",
                                        "cypher": "MATCH (a:disease) WHERE a.disease_name == '发烧' RETURN a.disease_name, a.age LIMIT 10"
                                    }
                                },
                                "relation_path_1": {
                                    "summary": "关系路径查询：MATCH (a:TypeA)-[r1:RelType1]->(b:TypeB)-[r2:RelType2]->(c:TypeC)... WHERE ... RETURN ... [LIMIT n] (支持2-10节点) (示例1)",
                                    "description": "关系路径查询：MATCH (a:TypeA)-[r1:RelType1]->(b:TypeB)-[r2:RelType2]->(c:TypeC)... WHERE ... RETURN ... [LIMIT n] (支持2-10节点)",
                                    "value": {
                                        "kn_id": "kn_medical",
                                        "cypher": "MATCH (a:disease)-[r:has_symptom]->(b:symptom) WHERE a.disease_name == '上气道梗阻' RETURN a.disease_name, b.symptom_name"
                                    }
                                },
                                "relation_path_2": {
                                    "summary": "关系路径查询：MATCH (a:TypeA)-[r1:RelType1]->(b:TypeB)-[r2:RelType2]->(c:TypeC)... WHERE ... RETURN ... [LIMIT n] (支持2-10节点) (示例2)",
                                    "description": "关系路径查询：MATCH (a:TypeA)-[r1:RelType1]->(b:TypeB)-[r2:RelType2]->(c:TypeC)... WHERE ... RETURN ... [LIMIT n] (支持2-10节点)",
                                    "value": {
                                        "kn_id": "kn_medical",
                                        "cypher": "MATCH (a:person)-[r1:belongs_to]->(b:school)-[r2:has_major]->(c:major) WHERE a.name == '张三' RETURN a.name, b.school_name, c.major_name"
                                    }
                                },
                                "relation_path_3": {
                                    "summary": "关系路径查询：MATCH (a:TypeA)-[r1:RelType1]->(b:TypeB)-[r2:RelType2]->(c:TypeC)... WHERE ... RETURN ... [LIMIT n] (支持2-10节点) (示例3)",
                                    "description": "关系路径查询：MATCH (a:TypeA)-[r1:RelType1]->(b:TypeB)-[r2:RelType2]->(c:TypeC)... WHERE ... RETURN ... [LIMIT n] (支持2-10节点)",
                                    "value": {
                                        "kn_id": "kn_medical",
                                        "cypher": "MATCH (a:person)-[r1:belongs_to]->(b:school)-[r2:has_major]->(c:major)-[r3:taught_by]->(d:teacher) WHERE a.name == '张三' RETURN a.name, b.school_name, c.major_name, d.teacher_name"
                                    }
                                },
                                "relation_path": {
                                    "summary": "关系路径查询：MATCH (a:TypeA)-[r1:RelType1]->(b:TypeB)-[r2:RelType2]->(c:TypeC)... WHERE ... RETURN ... [LIMIT n] (支持2-10节点)",
                                    "description": "关系路径查询：MATCH (a:TypeA)-[r1:RelType1]->(b:TypeB)-[r2:RelType2]->(c:TypeC)... WHERE ... RETURN ... [LIMIT n] (支持2-10节点)",
                                    "value": {
                                        "kn_id": "kn_medical",
                                        "cypher": "MATCH (a:disease)-[r:has_symptom]->(b:symptom) WHERE a.disease_name == '上气道梗阻' RETURN a.disease_name, b.symptom_name"
                                    }
                                }
                            }
                        }
                    }
                },
                "parameters": [
                    {
                        "name": "x-account-id",
                        "in": "header",
                        "required": false,
                        "schema": {
                            "type": "string"
                        },
                        "description": "账户ID，用于内部服务调用时传递账户信息"
                    },
                    {
                        "name": "x-account-type",
                        "in": "header",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "user",
                                "app",
                                "anonymous"
                            ],
                            "default": "user"
                        },
                        "description": "账户类型：user(用户), app(应用), anonymous(匿名)"
                    },
                    {
                        "name": "Content-Type",
                        "in": "header",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "default": "application/json"
                        },
                        "description": "内容类型"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "查询成功",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "description": "检索结果（meta + table格式）",
                                    "properties": {
                                        "meta": {
                                            "type": "object",
                                            "description": "请求与执行元信息"
                                        },
                                        "table": {
                                            "type": "object",
                                            "description": "结果表（类SQL格式）",
                                            "properties": {
                                                "columns": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string"
                                                    },
                                                    "description": "列名数组，格式：object_type.field_name"
                                                },
                                                "rows": {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "array",
                                                        "items": {}
                                                    },
                                                    "description": "行数据二维数组"
                                                }
                                            },
                                            "required": [
                                                "columns",
                                                "rows"
                                            ]
                                        }
                                    },
                                    "required": [
                                        "meta",
                                        "table"
                                    ]
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "参数错误或Cypher语法不支持",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "description": "错误信息"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}